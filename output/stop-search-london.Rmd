---
author: Dr Matt Ashby, Jill Dando Institute of Security and Crime Science, University
  College London
date: "`r format(Sys.Date(), '%B %Y')`"
categories: "Quarterly reports"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = FALSE, fig.align = "center")

library("fable")
library("feasts")
library("ggtext")
library("janitor")
library("lubridate")
library("scales")
library("sf")
library("tsibble")
library("tidyverse")
```

```{r functions}
source("../../helpers.R")

# define colour scheme, based on the UCL colour scheme defined at
# https://www.ucl.ac.uk/cam/brand/guidelines/colour
ucl_colours <- tribble(
  ~name, ~hex_code,
  "Dark Green", "#555025",
  "Dark Red", "#651D32",
  "Dark Purple", "#4B384C",
  "Dark Blue", "#003D4C",
  "Dark Brown", "#4E3629",
  "Mid Green", "#8F993E",
  "Mid Red", "#93272C",
  "Mid Purple", "#500778",
  "Mid Blue", "#002855",
  "Stone", "#D6D2C4",
  "Bright Green", "#B5BD00",
  "Bright Red", "#D50032",
  "Bright Blue", "#0097A9",
  "Bright Pink", "#AC145A",
  "Light Green", "#BBC592",
  "Light Red", "#E03C31",
  "Light Purple", "#C6B0BC",
  "Light Blue", "#8DB9CA",
  "Yellow", "#F6BE00",
  "Orange", "#EA7600",
  "Grey", "#8C8279",
  "Blue Celeste", "#A4DBE8"
)

ucl_colours_list <- set_names(ucl_colours$hex_code, ucl_colours$name)

search_type_colours <- c(
  "drugs" = ucl_colours_list[["Bright Green"]], 
  "weapons" = ucl_colours_list[["Light Purple"]], 
  "stolen goods" = ucl_colours_list[["Bright Blue"]], 
  "firearms" = ucl_colours_list[["Bright Red"]], 
  "other" = ucl_colours_list[["Blue Celeste"]], 
  "unknown" = ucl_colours_list[["Grey"]],
  "weapons (based on reasonable suspicion)" = ucl_colours_list[["Bright Pink"]],
  "weapons (based on authorisation)" = ucl_colours_list[["Light Red"]]
)

```

```{r load data, include=FALSE}
stops <- here::here("analysis-data/stops.rds") %>% 
  read_rds() %>%
  mutate(
    object_of_search = case_when(
      legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
        "offensive weapons",
      TRUE ~ object_of_search
    ),
    object = recode(
      object_of_search,
      "controlled drugs" = "drugs",
      "offensive weapons" = "weapons",
      "evidence of offences under the act" = "unknown",
      "articles for use in criminal damage" = "other",
      "article for use in theft" = "other",
      "evidence of wildlife offences" = "other",
      "fireworks" = "other",
      "goods on which duty has not been paid etc." = "other",
      "anything to threaten or harm anyone" = "weapons",
      "crossbows" = "weapons",
      "psychoactive substances" = "drugs"
    ),
    outcome = recode(
      outcome,
      "suspect arrested" = "arrest",
      "community resolution" = "community/local resolution",
      "local resolution" = "community/local resolution",
      "caution (simple or conditional)" = "caution",
      "offender cautioned" = "caution",
      "khat or cannabis warning" = "drugs warning",
      "offender given penalty notice" = "fixed penalty",
      "penalty notice for disorder" = "fixed penalty",
      "offender given drugs possession warning" = "drugs warning",
      "a no further action disposal" = "no further action",
      "nothing found - no further action" = "no further action",
      "suspected psychoactive substances seized - no further action" = 
        "no further action",
      "summons / charged by post" = "charged by post",
      "suspect summonsed to court" = "charged by post"
    ),
    year = year(date),
    year_month = yearmonth(date)
  ) %>% 
  replace_na(list(object = "unknown", outcome = "unknown")) %>% 
  mutate(
    outcome = fct_relevel(
      outcome,
      "arrest",
      "charged by post",
      "caution",
      "fixed penalty",
      "community/local resolution",
      "drugs warning",
      "no further action",
      "unknown"
    )
  ) %>%
  filter(year >= 2018)

# load other data

people <- read_rds(here::here("analysis-data/people.rds"))

imd <- read_rds(here::here("analysis-data/imd.rds"))

lsoa <- sf::read_sf("https://opendata.arcgis.com/datasets/155d7311193245d39cd4ac27383881f3_0.geojson") %>% 
  select(lsoa_code = LSOA11CD, lsoa_name = LSOA11NM, geometry)

london_boroughs <- read_sf("https://opendata.arcgis.com/datasets/a217247516cb42b2aa329cb0205c6ee0_0.geojson") %>% 
  filter(str_detect(ctyua19cd, "^E09")) %>% 
  rename(borough = ctyua19nm) %>% 
  st_transform(27700)

london_outline <- london_boroughs %>% 
  st_union() %>% 
  st_sf() %>% 
  mutate(region = "London")

ward_lad_lookup <- read_csv("https://opendata.arcgis.com/datasets/e169bb50944747cd83dcfb4dd66555b1_0.csv") %>% 
  janitor::clean_names() %>% 
  filter(str_detect(lad19cd, "^E09")) %>% 
  select(wd19cd, borough = lad19nm)

london_wards <- read_sf("https://opendata.arcgis.com/datasets/24fd788001d941c5a244dda6fe81dbb2_0.geojson") %>% 
  st_transform(27700) %>% 
  left_join(ward_lad_lookup, by = "wd19cd") %>% 
  filter(!is.na(borough)) %>% 
  select(ward = wd19nm, borough, geometry)

london_stations <- here::here("analysis-data/stations.gpkg") %>% 
  st_read(quiet = TRUE) %>% 
  st_transform(27700) %>% 
  rownames_to_column(var = "id") %>% 
  mutate(id = as.numeric(id))
```

```{r remove non-London BTP stops}
btp_london_stops <- stops %>% 
  filter(force == "British Transport Police", !is.na(latitude), 
         !is.na(longitude)) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326, remove = FALSE) %>% 
  st_transform(27700) %>% 
  st_join(london_outline) %>% 
  filter(region == "London") %>% 
  as_tibble() %>% 
  select(-region)

stops <- stops %>% 
  filter(force != "British Transport Police") %>% 
  bind_rows(btp_london_stops)
```

---
title: "Stop and search in London, `r format(max(stops$date), "%B %Y")`"
---

```{r check data values are as expected}
```


```{r count stops}
monthly_counts <- stops %>% 
  count(year_month) %>% 
  mutate(
    year_month = as_date(year_month),
    diff = n - lag(n),
    diff_perc = diff / lag(n)
  )
```

```{r monthly count trend}
monthly_counts_feats <- as.list(
  feasts::feat_stl(monthly_counts$n, .period = 12)
)
```

```{r monthly count anomaly, include=FALSE}
monthly_counts_anomaly <- timetk::tk_anomaly_diagnostics(
  monthly_counts, 
  .date_var = year_month, 
  .value = n
)
```

```{r search types}
main_types <- c("drugs", "firearms", "stolen goods", "weapons")

searches_by_type <- count(stops, year_month, object)
```

```{r search results by month}
search_result_month_counts <- stops %>% 
  mutate(
    positive = !outcome %in% c("no further action", "unknown"),
    year_month = as_date(year_month)
  ) %>% 
  count(year_month, positive) %>% 
  group_by(year_month) %>% 
  mutate(prop = n / sum(n)) %>% 
  ungroup()
```

```{r search disparity}
person_stops <- filter(
  stops, 
  type %in% c("Person search", "Person and Vehicle search")
)

age_counts <- person_stops %>% 
  filter(year_month == max(year_month), !is.na(age_range)) %>% 
  tabyl(age_range)

sde_counts <- person_stops %>% 
  filter(year_month == max(year_month), !is.na(self_defined_ethnicity)) %>% 
  mutate(
    sde_group = case_when(
      self_defined_ethnicity == "Other ethnic group - Not stated" ~ 
        NA_character_,
      str_detect(self_defined_ethnicity, "^Asian") ~ "Asian/Asian British",
      str_detect(self_defined_ethnicity, "^Black") ~ "Black/Black British",
      str_detect(self_defined_ethnicity, "^Mixed") ~ 
        "from multiple ethnic groups",
      str_detect(self_defined_ethnicity, "^Other") ~ 
        "from another ethnic group",
      str_detect(self_defined_ethnicity, "^White") ~ "white",
      TRUE ~ NA_character_
    )
  ) %>% 
  tabyl(sde_group) %>% 
  arrange(desc(valid_percent))

stops_disparity <- person_stops %>% 
  filter(
    year_month == max(year_month), 
    !is.na(gender),
    gender %in% c("female", "male"),
    !is.na(age_range), 
    age_range != "under 10",
    !str_detect(self_defined_ethnicity, "^Other ethnic group")
  ) %>% 
  rename(sex = gender) %>% 
  count(sex, age_range, self_defined_ethnicity, name = "searches") %>% 
  left_join(people, by = c("sex", "age_range", "self_defined_ethnicity")) %>% 
  separate(self_defined_ethnicity, c("ethnic_group", "ethnicity"), " - ") %>% 
  group_by(age_range, ethnic_group, sex) %>% 
  summarise(people = sum(people), searches = sum(searches), 
            .groups = "drop") %>% 
  mutate(
    ethnic_group = str_extract(ethnic_group, "^\\w+"),
    age_label = case_when(
      age_range %in% c("under 10", "10-17") & sex == "female" ~ "girls",
      age_range %in% c("under 10", "10-17") & sex == "male" ~ "boys",
      !age_range %in% c("under 10", "10-17") & sex == "female" ~ "women",
      !age_range %in% c("under 10", "10-17") & sex == "male" ~ "men",
    ),
    group = str_glue("**{age_label}** aged **{age_range}** identifying as ",
                     "**{ethnic_group}**"),
    search_rate = searches / (people / 1000)
  )

stops_disparity_object <- person_stops %>% 
  mutate(
    object = case_when(
      object == "weapons" & 
        legislation == "Police and Criminal Evidence Act 1984 (section 1)" ~ 
        "weapons (based on reasonable suspicion)",
      object == "weapons" & 
        legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
        "weapons (based on authorisation)",
      object == "weapons" ~ "unknown",
      TRUE ~ object
    )
  ) %>% 
  filter(
    year_month == max(year_month), 
    !is.na(age_range), 
    age_range != "under 10",
    !is.na(gender),
    gender %in% c("female", "male"),
    !object %in% c("other", "unknown"),
    !str_detect(self_defined_ethnicity, "^Other ethnic group")
  ) %>% 
  select(object, sex = gender, age_range, self_defined_ethnicity) %>% 
  mutate_if(is.character, as.factor) %>% 
  count(object, sex, age_range, self_defined_ethnicity, name = "searches", .drop = FALSE) %>% 
  left_join(people, by = c("sex", "age_range", "self_defined_ethnicity")) %>% 
  separate(self_defined_ethnicity, c("ethnic_group", "ethnicity"), " - ") %>% 
  group_by(object, age_range, ethnic_group, sex) %>% 
  summarise(people = sum(people), searches = sum(searches), 
            .groups = "drop") %>% 
  mutate(
    ethnic_group = str_extract(ethnic_group, "^\\w+"),
    age_label = case_when(
      age_range %in% c("under 10", "10-17") & sex == "female" ~ "girls",
      age_range %in% c("under 10", "10-17") & sex == "male" ~ "boys",
      !age_range %in% c("under 10", "10-17") & sex == "female" ~ "women",
      !age_range %in% c("under 10", "10-17") & sex == "male" ~ "men",
    ),
    group = str_glue("{age_label}, {age_range}, {ethnic_group}"),
    search_rate = searches / (people / 1000)
  )

stops_model <- stops_disparity %>% 
  mutate(
    age_range = fct_relevel(age_range, "over 34"),
    ethnic_group = fct_relevel(ethnic_group, "White"),
    # ethnicity = str_glue("{ethnic_group} – {ethnicity}"),
    # ethnicity = fct_relevel(ethnicity, "White – British"),
    sex = fct_relevel(sex, "female")
  ) %>% 
  {
    glm(log(search_rate) ~ sex + age_range + ethnic_group, data = .)
  } %>% 
  broom::tidy() %>% 
  filter(p.value < 0.05) %>%
  arrange(desc(estimate)) %>% 
  mutate(
    term = case_when(
      str_detect(term, "^age_range") ~ 
        str_glue("being aged {str_remove(term, '^age_range')}"),
      str_detect(term, "^ethnic_group") ~ 
        str_glue("self-defining as '{str_remove(term, '^ethnic_group')}'"),
      str_detect(term, "^sex") ~ str_glue("being {str_remove(term, '^sex')}"),
      TRUE ~ term
    )
  )

overall_search_rate <- sum(stops_disparity$searches) / (sum(stops_disparity$people) / 1000)
```


# Headlines

  * **Police in London stopped and searched `r comma(pluck(count(filter(stops, year_month == max(year_month))), "n", 1))` people and vehicles in `r format(max(stops$date), "%B %Y")`, with the number of monthly searches generally `r ifelse(monthly_counts_feats$linearity > 0, "increasing", "increasing")` over the past two years.** 
  * **`r percent(pluck(arrange(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), desc(n)), "n", 1))` of searches were for `r pluck(arrange(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), desc(n)), "object", 1)`, with `r percent(1 - tail(search_result_month_counts$prop, 1))` of all searches resulting in no further action.**
  * **Different demographic groups are searched at different rates, with `r str_remove_all(pluck(arrange(stops_disparity, desc(search_rate)), "group", 1), "\\*\\*")` being `r number(pluck(arrange(stops_disparity, desc(search_rate)), "search_rate", 1) / overall_search_rate)` times more likely to be searched than the population as a whole.**


# Introduction

Stop and search is a legal power that allows police officers to search people to find out if they are carrying prohibited items such as drugs, weapons or stolen goods. Stop and search means officers can confirm if a person is or is not in possession of contraband without arresting them and taking them to a police station, but it is also a source of tension between police and communities. [A review by the College of Policing found little relationship between how many searches police do and how much crime occurs](https://whatworks.college.police.uk/Research/Documents/SS_and_crime_report.pdf), but [police insist stop and search helps them fight crime](https://www.met.police.uk/advice/advice-and-information/st-s/stop-and-search/why-we-use-stop-and-search/).

**In `r format(max(stops$date), "%B %Y")`, police officers in London carried out `r comma(pluck(count(filter(stops, year_month == max(year_month))), "n", 1))` stop-and-searches**. Of those, `r percent(pluck(filter(janitor::adorn_percentages(count(stops, force), denominator = "col"), force == "Metropolitan Police Service"), "n"))` were conducted by the Metropolitan Police, `r percent(pluck(filter(janitor::adorn_percentages(count(stops, force), denominator = "col"), force == "British Transport Police"), "n"))` by British Transport Police and `r ifelse(pluck(filter(janitor::adorn_percentages(count(stops, force), denominator = "col"), force == "City of London Police"), "n") < 0.001, "less than 0.1%", paste("the remaining", percent(pluck(filter(janitor::adorn_percentages(count(stops, force), denominator = "col"), force == "City of London Police"), "n"))))` by City of London Police. Across the three forces, `r percent(pull(filter(janitor::adorn_percentages(count(stops, type), "col"), type == "Person search"), n))` of stops were of pedestrians, `r percent(pull(filter(janitor::adorn_percentages(count(stops, type), "col"), type == "Person and Vehicle search"), n))` of people in vehicles and `r percent(pull(filter(janitor::adorn_percentages(count(stops, type), "col"), type == "Vehicle search"), n))` of only vehicles.

The number of searches carried out in `r format(max(stops$date), "%B")` was **`r ifelse(nth(monthly_counts$n, -1) - nth(monthly_counts$n, -2) > 0, "an increase", "a decrease")` of `r percent(abs((nth(monthly_counts$n, -1) - nth(monthly_counts$n, -2)) / nth(monthly_counts$n, -2)))` from the previous month**`r ifelse(last(abs(monthly_counts$diff)) > max(abs(head(tail(monthly_counts$diff, 6), 5))), paste(" and the largest month-to-month change since", ifelse(nrow(slice(filter(slice(monthly_counts, 1:n() - 1), abs(diff) > abs(last(monthly_counts$diff))), n())) == 0, paste("at least", format(first(monthly_counts$year_month), "%B %Y")), format(pluck(slice(filter(slice(monthly_counts, 1:n() - 1), abs(diff) > abs(last(monthly_counts$diff))), n()), "year_month"), "%B% %Y"))), "")`.
`r ifelse(monthly_counts_feats$trend_strength > 0.5, paste(" This", ifelse(nth(monthly_counts$n, -1) - nth(monthly_counts$n, -2) > 0, "increase", "decrease"), "was", ifelse((monthly_counts_feats$trend_strength > 0 & nth(monthly_counts$n, -1) - nth(monthly_counts$n, -2) > 0) | (monthly_counts_feats$trend_strength < 0 & nth(monthly_counts$n, -1) - nth(monthly_counts$n, -2) < 0), "consistent with", "contrary to"), "the long-term", ifelse(monthly_counts_feats$linearity > 0, "upward", "downward"), "trend, with stops having", ifelse(monthly_counts_feats$linearity > 0, "**increased", "**decreased"), "by", percent(mean(tail(monthly_counts$diff_perc, 24))), "per month on average over the past two years.**"), "")`

```{r overall trend chart, fig.asp=0.5}
ggplot(monthly_counts_anomaly, aes(year_month, observed, colour = anomaly)) + 
  geom_segment(aes(xend = year_month, yend = 0), colour = "grey70", 
               size = 0.25) +
  ggrepel::geom_label_repel(
    aes(label = format(year_month, "%b %Y")),
    data = filter(monthly_counts_anomaly, anomaly == "Yes"),
    box.padding = unit(1, "lines"),
    direction = "x",
    size = chart_elements$label_text_size,
    label.size = NA
  ) +
  geom_point(size = 3, shape = 21, fill = "white", show.legend = FALSE,
             data = filter(monthly_counts_anomaly, anomaly == "Yes")) +
  geom_point(colour = ucl_colours_list[["Orange"]], size = 0.75) +
  geom_smooth(
    aes(alpha = TRUE),
    method = "loess", 
    formula = "y ~ x", 
    se = FALSE, 
    data = filter(monthly_counts_anomaly, anomaly == "No"),
    colour = "#EA7600", 
    key_glyph = "timeseries"
  ) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b '%y", 
               expand = expansion(mult = c(0.025, 0.025))) +
  scale_y_continuous(labels = comma_format(), limits = c(0, NA), 
                     expand = expansion(mult = c(0, 0.02))) +
  scale_colour_manual(values = c("No" = "grey70", "Yes" = "#EA7600"), 
                      guide = guide_none()) +
  scale_alpha_manual(
    values = c(`TRUE` = 1),
    labels = c(`TRUE` = "trend over time, excluding anomalies")
  ) +
  labs(
    title = str_glue(
      "Number of stop-and-searches in London, ",
      "{format(min(stops$date), '%B %Y')} to {format(max(stops$date), '%B %Y')}"
    ),
    x = NULL, 
    y = "number of searches", 
    caption = str_glue("labelled months are anomalies with unusually high/low ",
                       "numbers of stops"),
    alpha = NULL
  ) +
  theme_ashby() +
  theme(
    legend.background = element_rect(colour = NA, fill = "white"),
    legend.justification = c(0, 1), 
    legend.position = c(0, 1),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```


# What items are people searched for?

Police officers are empowered to search people for different items -- including drugs, items to use in theft or criminal damage, stolen goods, weapons and even some fireworks -- under different acts of parliament. Although police emphasise that stop and search "[protects Londoners by taking weapons off the streets](https://www.met.police.uk/police-forces/metropolitan-police/areas/about-us/about-the-met/stop-and-search/)", only about one in `r number_to_text(round(1 / pull(filter(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), object == "weapons"), "n")))` searches in `r format(max(stops$year_month), "%B")` were for weapons -- **`r percent(pluck(arrange(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), desc(n)), "n", 1))` of searches were for `r pluck(arrange(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), desc(n)), "object", 1)`**.

```{r search types chart, fig.asp=0.33}
searches_by_type %>% 
  filter(year_month == max(year_month)) %>% 
  mutate(
    align = ifelse(n > max(n) / 2, 1, 0),
    object = fct_relevel(fct_reorder(object, n), "unknown", "other"),
    percent = percent(n / sum(n), accuracy = 0.1)
  ) %>% 
  ggplot(aes(n, object, fill = object, label = str_glue(" {percent} "), 
             hjust = align)) +
  geom_col() +
  geom_text(size = chart_elements$label_text_size) +
  scale_x_continuous(
    labels = comma_format(), 
    expand = expansion(mult = c(0, 0.025))
  ) +
  scale_fill_manual(values = search_type_colours) +
  labs(
    title = str_glue("Searches by type of object being searched for, ",
                     "{format(max(stops$year_month), '%B %Y')}"),
    x = "number of searches", 
    y = NULL
  ) +
  theme_ashby() +
  theme(
    legend.position = "none",
    panel.grid.major.x = element_line(),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```

```{r search types change}
search_type_trends <- searches_by_type %>% 
  group_by(object) %>% 
  arrange(year_month) %>% 
  mutate(
    change = n / first(n),
    year_month = as_date(year_month)
  ) %>% 
  ungroup() %>% 
  as_tsibble(key = object, index = year_month) %>% 
  model(lm = fable::TSLM(change ~ trend())) %>% 
  mutate(coefs = map(lm, broom::tidy)) %>% 
  unnest(cols = c(coefs)) %>% 
  filter(term == "trend()", object %in% main_types)

search_type_order <- searches_by_type %>% 
  filter(object %in% main_types) %>% 
  group_by(object) %>% 
  summarise(n = mean(n), .groups = "drop") %>% 
  arrange(desc(n)) %>% 
  pull(object)

search_type_increase <- search_type_trends %>% 
  filter(estimate > 0 & p.value < 0.05) %>% 
  pull("object")

search_type_decrease <- search_type_trends %>% 
  filter(estimate < 0 & p.value < 0.05) %>% 
  pull("object")
```

About `r percent(sum(pull(filter(janitor::adorn_percentages(filter(searches_by_type, year_month == max(year_month)), denominator = "col"), object %in% c("drugs", "firearms", "stolen goods", "weapons")), "n")))` of searches are looking for the four main types of contraband: drugs, firearms, stolen goods and weapons. Since 2018, the number of searches for `r case_when(length(search_type_increase) == length(main_types) ~ str_glue("{vector_to_text(search_type_increase)} have all increased"), length(search_type_decrease) == length(main_types) ~ str_glue("{vector_to_text(search_type_decrease)} have all decreased"), length(search_type_increase) > 0 & length(search_type_decrease) > 0 ~ str_glue("{vector_to_text(search_type_increase)} have increased while searches for {vector_to_text(search_type_decrease)} have decreased{ifelse(length(search_type_increase) + length(search_type_decrease) < length(main_types), paste0(' and ', vector_to_text(setdiff(main_types, search_type_increase))), '')}"), length(search_type_increase) > 0 ~ str_glue("{vector_to_text(search_type_increase)} have increased while searches for {vector_to_text(setdiff(main_types, search_type_increase))} have remained largely static"), length(search_type_decrease) > 0 ~ str_glue("{vector_to_text(search_type_decrease)} have decreased while searches for {vector_to_text(setdiff(main_types, search_type_increase))} have remained largely static"), TRUE ~ "all these items have remained largely static")`.

```{r search types change chart, fig.asp=0.5}
searches_by_type %>% 
  filter(!object %in% c("other", "unknown")) %>% 
  group_by(object) %>% 
  arrange(year_month) %>% 
  mutate(
    change = n / first(n),
    year_month = as_date(year_month)
  ) %>% 
  ungroup() %>% 
  mutate(object = fct_relevel(object, search_type_order)) %>% 
  ggplot(aes(year_month, change, colour = object)) +
  geom_segment(aes(xend = year_month, yend = 1), colour = "grey70", 
               size = 0.25) +
  geom_hline(aes(yintercept = 1), 
             colour = chart_elements$reference_line_colour) +
  geom_point(colour = "grey70", size = 0.75) +
  geom_smooth(method = "loess", formula = "y ~ x", se = FALSE) +
  scale_x_date(date_breaks = "1 year", date_labels = "'%y",
               expand = expansion(mult = c(0.025, 0.025))) +
  scale_y_continuous(labels = number_format(accuracy = 1, prefix = "x")) +
  scale_colour_manual(values = search_type_colours) +
  facet_grid(
    cols = vars(object), 
    scales = "free", 
    labeller = as_labeller(function (string) paste("searches for", string))
  ) +
  labs(
    title = str_glue(
      "Change in number of searches by type, ",
      "{format(min(stops$date), '%B %Y')} to {format(max(stops$date), '%B %Y')}"
    ),
    x = NULL, 
    y = "change in searches compared to January 2018"
  ) +
  theme_ashby() +
  theme(
    legend.position = "none",
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```

```{r weapons trend, include=FALSE}
weapon_search_counts <- stops %>% 
  filter(
    legislation %in% c(
      "Police and Criminal Evidence Act 1984 (section 1)", 
      "Criminal Justice and Public Order Act 1994 (section 60)"
    ),
    object_of_search %in% 
      c("offensive weapons", "anything to threaten or harm anyone")
  ) %>% 
  count(legislation, year_month) %>% 
  mutate(
    year_month = as_date(year_month),
    diff = n - lag(n),
    diff_perc = diff / lag(n)
  )

weapon_search_anomolies <- weapon_search_counts %>% 
  group_by(legislation) %>% 
  nest() %>% 
  mutate(
    anomalies = map(data, timetk::tk_anomaly_diagnostics, 
                    .date_var = year_month, .value = n)
  ) %>% 
  unnest(cols = anomalies)

weapon_search_trends <- weapon_search_counts %>% 
  filter(year_month >= max(year_month) - months(24)) %>% 
  group_by(legislation) %>% 
  arrange(year_month) %>% 
  mutate(
    change = n / first(n),
    year_month = as_date(year_month)
  ) %>% 
  ungroup() %>% 
  as_tsibble(key = legislation, index = year_month) %>% 
  model(lm = fable::TSLM(change ~ trend())) %>% 
  mutate(coefs = map(lm, broom::tidy)) %>% 
  unnest(cols = c(coefs)) %>% 
  filter(term == "trend()")
```


Police can search people for weapons using two different legal powers. Searches under [section 1 of the Police and Criminal Evidence Act 1984](https://www.legislation.gov.uk/ukpga/1984/60/section/1) (PACE) require the officer to have "reasonable grounds for suspecting" that the person is carrying an offensive weapon or other prohibited item. Conversely, officers can search people under section 60 of the [Criminal Justice and Public Order Act 1994](https://www.legislation.gov.uk/ukpga/1994/33/section/60) (CJPOA) without having any reason to think the person has a weapon, as long as a more-senior officer believes "incidents involving serious violence may take place" in the area. These 'section 60' searches are particularly controversial because they allow officers to search *anyone* in an area, even if there is no reason to think they have a weapon in their possession. In `r format(max(stops$date), "%B %Y")`, `r percent(pull(filter(janitor::adorn_percentages(filter(weapon_search_counts, year_month == max(year_month)), "col"), legislation == "Police and Criminal Evidence Act 1984 (section 1)"), "n"))` of weapons searches are based on reasonable suspicion under PACE section 1, with the remaining `r percent(pull(filter(janitor::adorn_percentages(filter(weapon_search_counts, year_month == max(year_month)), "col"), legislation == "Criminal Justice and Public Order Act 1994 (section 60)"), "n"))` based on authorisations under CJPOA section 60.

```{r weapons trend chart, fig.asp=0.5}
weapon_search_chart_data <- weapon_search_anomolies %>% 
  mutate(
    legislation = recode_factor(
      legislation,
      "Police and Criminal Evidence Act 1984 (section 1)" = 
        "searches under PACE s. 1\n(based on reasonable suspicion)", 
      "Criminal Justice and Public Order Act 1994 (section 60)" = 
        "searches under CJPOA s. 60\n(based on authorisation)"
    )
  )

ggplot(weapon_search_chart_data, 
       aes(year_month, observed, colour = legislation)) +
  geom_segment(aes(xend = year_month, yend = 1), size = 0.25, 
               colour = "grey70") +
  ggrepel::geom_label_repel(
    aes(label = format(year_month, "%b %Y")),
    data = filter(weapon_search_chart_data, anomaly == "Yes"),
    box.padding = unit(1, "lines"),
    direction = "x",
    size = chart_elements$label_text_size,
    label.size = NA
  ) +
  geom_point(size = 3, shape = 21, fill = "white", show.legend = FALSE,
             data = filter(weapon_search_chart_data, anomaly == "Yes")) +
  geom_point(size = 0.75) +
  geom_smooth(method = "loess", formula = "y ~ x", se = FALSE, 
              data = filter(weapon_search_chart_data, anomaly == "No")) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b '%y", 
               expand = expansion(mult = c(0.025, 0.025))) +
  scale_y_continuous(labels = comma_format(), limits = c(0, NA), 
                     expand = expansion(mult = c(0, 0.025))) +
  scale_colour_manual(
    values = c(ucl_colours_list[["Light Red"]], 
               ucl_colours_list[["Bright Pink"]])
  ) +
  facet_grid(
    cols = vars(legislation), 
    scales = "free"
  ) +
  labs(
    title = str_glue(
      "Change in number of searches for weapons, ",
      "{format(min(stops$date), '%B %Y')} to {format(max(stops$date), '%B %Y')}"
    ),
    x = NULL, 
    y = "number of searches"
  ) +
  theme_ashby() +
  theme(
    legend.position = "none",
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```


Searches based on reasonable suspicion the person being searched is carrying a weapon have `r ifelse(pull(filter(weapon_search_trends, legislation == "Police and Criminal Evidence Act 1984 (section 1)"), p.value) < 0.05, paste(ifelse(pull(filter(weapon_search_trends, legislation == "Police and Criminal Evidence Act 1984 (section 1)"), estimate) > 0, "increased", "decreased"), "by about", percent(abs(mean(pull(filter(weapon_search_counts, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month >= max(year_month) - months(24)), diff_perc)))), "per month on average"), "remained largely static")` over the past two years. In comparison to that trend, the number of these searches in `r format(max(stops$date), "%B %Y")` was `r ifelse(pull(filter(weapon_search_anomolies, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month == max(year_month)), anomaly) == "Yes", ifelse(pull(filter(weapon_search_anomolies, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month == max(year_month)), remainder) > 0, "anomalously high", "anomalously low"), "within the expected range")` `r ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month)) > 0, paste0("-- prior to ", format(max(stops$date), "%B"), ", PACE section 1 searches had been ", ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month)) > 0, paste("anomalously high in", vector_to_text(format(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month), "%B %Y"))), ""), ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month)) > 0 & length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month)) > 0, " and ", ""), ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month)) > 0, paste("anomalously low in", vector_to_text(format(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Police and Criminal Evidence Act 1984 (section 1)", year_month != max(year_month)), year_month), "%B %Y"))), ""), "."), ".")`
Non-suspicion searches under section 60 have `r ifelse(pull(filter(weapon_search_trends, legislation == "Criminal Justice and Public Order Act 1994 (section 60)"), p.value) < 0.05, paste(ifelse(pull(filter(weapon_search_trends, legislation == "Criminal Justice and Public Order Act 1994 (section 60)"), estimate) > 0, "increased", "decreased"), "by about", percent(abs(mean(pull(filter(weapon_search_counts, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month >= max(year_month) - months(24)), diff_perc)))), "per month on average"), "remained largely static")` over the past two years, with the number of these searches in `r format(max(stops$date), "%B %Y")` `r ifelse(pull(filter(weapon_search_anomolies, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month == max(year_month)), anomaly) == "Yes", ifelse(pull(filter(weapon_search_anomolies, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month == max(year_month)), remainder) > 0, "anomalously high compared to that trend", "anomalously low compared to that trend"), "within the range that would be expected based on that trend")`. `r ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month)) > 0, paste0("Before that, section 60 searches had been ", ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month)) > 0, paste("anomalously high in", vector_to_text(format(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month), "%B %Y"))), ""), ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder > 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month)) > 0 & length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month)) > 0, " and ", ""), ifelse(length(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month)) > 0, paste("anomalously low in", vector_to_text(format(pull(filter(weapon_search_anomolies, anomaly == "Yes", remainder < 0, legislation == "Criminal Justice and Public Order Act 1994 (section 60)", year_month != max(year_month)), year_month), "%B %Y"))), ""), "."), "")`



# Who do police search?

Of the `r comma(pull(count(filter(person_stops, year_month == max(year_month))), n))` searches of pedestrians and vehicle occupants in `r format(max(stops$date), "%B %Y")`, **`r percent(pull(filter(tabyl(filter(person_stops, gender %in% c("female", "male"), year_month == max(year_month)), gender), gender == "male"), percent))` were searches of men or boys**, with `r percent(sum(pull(filter(age_counts, age_range %in% c("under 10", "10-17")), percent)))` of people searched being aged under 18, `r percent(pull(filter(age_counts, age_range == "18-24"), percent))` between 18 and 24, and `r percent(sum(pull(filter(age_counts, age_range %in% c("25-34", "over 34")), percent)))` being 25 or older. The self-defined ethnicity of the person searched was known for `r percent(1 - pull(filter(sde_counts, is.na(sde_group)), percent))` of searches, of which `r percent(pull(slice(sde_counts, 1), valid_percent))` of people described themselves as `r pull(slice(sde_counts, 1), sde_group)`, `r percent(pull(slice(sde_counts, 2), valid_percent))` as `r pull(slice(sde_counts, 2), sde_group)` and `r percent(pull(slice(sde_counts, 3), valid_percent))` as `r pull(slice(sde_counts, 3), sde_group)`.

**Search rates vary hugely across different groups**. While disparity between ethnic groups has generated much comment, there are also disparities betweens age groups and sexes. The best demographic predictors of a person in London being searched in `r format(max(stops$date), "%B %Y")` were (in descending order) `r stops_model$term[1]`, `r stops_model$term[2]` and `r stops_model$term[3]`, with `r nrow(filter(stops_disparity, search_rate > overall_search_rate))` groups (shown in the chart below) being searched at a higher rate than average. The reasons for these differences are likely to be complex: many types of offending are concentrated among some groups (particularly young men) as well as in some neighbourhoods, there is a [long history of racism in policing](https://www.bbc.co.uk/news/uk-47300343) and there is also an interaction between factors such as deprivation and the amount of time people spend in public (where almost-all searches occur).

```{r stops disparity chart, fig.asp=0.5}
stops_disparity %>% 
  arrange(desc(search_rate)) %>% 
  # filter(sex == "male") %>% 
  filter(search_rate > overall_search_rate) %>% 
  add_row(group = "**all people**", search_rate = overall_search_rate) %>% 
  mutate(
    group = fct_relevel(fct_reorder(group, search_rate), "**all people**", 
                        after = Inf)
  ) %>% 
  ggplot(aes(search_rate, group, fill = group == "**all people**")) +
  geom_col(width = 0.75) +
  geom_vline(
    aes(xintercept = x), 
    data = tibble(
      x = seq(0, ceiling(max(stops_disparity$search_rate)), by = 1)
    ), 
    colour = "white", 
    alpha = 0.75
  ) +
  scale_x_continuous(expand = c(0, 0.05)) +
  scale_fill_manual(
    values = c(`TRUE` = "black", `FALSE` = ucl_colours_list[["Orange"]])
  ) +
  labs(
    title = str_glue("Search rates for different demographic groups, ",
                     "{format(max(stops$date), '%B %Y')}"),
    x = "searches per 1,000 people"
  ) +
  theme_ashby() +
  theme(
    axis.text.y = element_markdown(),
    axis.ticks.y = element_blank(),
    axis.title.y = element_blank(),
    legend.position = "none",
    panel.grid = element_blank(),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```


```{r}
stops_disparity_object_chart <- stops_disparity_object %>%
  group_by(object) %>%
  mutate(
    rel_search_rate = search_rate / (sum(searches) / (sum(people) / 1000))
  ) %>%
  ungroup() %>%
  arrange(desc(rel_search_rate)) %>%
  mutate(
    object_label = recode(
      object,
      "weapons (based on authorisation)" = "weapons (s. 60)",
      "weapons (based on reasonable suspicion)" = "weapons (s. 1)"
    ),
    group = str_glue("{group}"),
    group = fct_reorder(group, rel_search_rate)
  )
```

In comparison to the population as a whole, people in the group with the highest search rate (`r str_remove_all(pluck(arrange(stops_disparity, desc(search_rate)), "group", 1), "\\*\\*")`) are `r number(pluck(arrange(stops_disparity, desc(search_rate)), "search_rate", 1) / overall_search_rate)` times more likely to be stopped and searched. Disparities in search rates also vary according to the type of search. Disparity is highest in searches for `r stops_disparity_object_chart$object[1]`, for which `r stops_disparity_object_chart$age_label[1]` aged `r stops_disparity_object_chart$age_range[1]` identifying as `r stops_disparity_object_chart$ethnic_group[1]` were `r number(stops_disparity_object_chart$rel_search_rate[1])` times more likely to be searched than the population at large. Of the `r number(length(unique(stops_disparity_object$sex)) * length(unique(stops_disparity_object$age_range)) * length(unique(stops_disparity_object$ethnic_group)))` combinations of age, ethnic-group and sex categories present in the data, `r case_when(length(unique(pull(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), group))) == 1 ~ str_glue("the rate of searches was highest for all five of the main types of search for {stops_disparity_object_chart$age_label[1]} aged {stops_disparity_object_chart$age_range[1]} who identified as {stops_disparity_object_chart$ethnic_group[1]}"), length(unique(pull(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), sex))) == 1 & length(unique(pull(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), ethnic_group))) == 1 ~ str_glue("the rate of searches was highest for all five of the main types of search for {stops_disparity_object_chart$age_label[1]} who identified as {stops_disparity_object_chart$ethnic_group[1]}"), length(unique(pull(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), sex))) == 1 & length(unique(pull(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range))) == 1 ~ str_glue("the rate of searches was highest for all five of the main types of search for {stops_disparity_object_chart$age_label[1]} aged {stops_disparity_object_chart$age_range[1]}"), pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range, ethnic_group, sex), desc(n)), "n", 1) > 2 ~ str_glue("the rate of searches was highest for {number_to_text(pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range, ethnic_group, sex), desc(n)), 'n', 1))} of the five of the main types of search for {stops_disparity_object_chart$age_label[1]} aged {stops_disparity_object_chart$age_range[1]} who identified as {stops_disparity_object_chart$ethnic_group[1]}"), pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), ethnic_group, sex), desc(n)), "n", 1) > 2 ~ str_glue("the rate of searches was highest for {number_to_text(pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range, ethnic_group, sex), desc(n)), 'n', 1))} of the five of the main types of search for {stops_disparity_object_chart$age_label[1]} who identified as {stops_disparity_object_chart$ethnic_group[1]}"), pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range, sex), desc(n)), "n", 1) > 2 ~ str_glue("the rate of searches was highest for {number_to_text(pluck(arrange(count(ungroup(slice(group_by(arrange(stops_disparity_object_chart, desc(rel_search_rate)), object), 1)), age_range, ethnic_group, sex), desc(n)), 'n', 1))} of the five of the main types of search for {stops_disparity_object_chart$age_label[1]} aged {stops_disparity_object_chart$age_range[1]}"), TRUE ~ "")`. 


```{r stops disparity object chart, fig.asp=0.75}
# stops_disparity_object_chart %>% 
#   ggplot(aes(rel_search_rate, group, fill = object, 
#              label = number(rel_search_rate, accuracy = 0.1, prefix = " x"))) +
#   geom_col(width = 0.75) +
#   geom_vline(
#     aes(xintercept = x),
#     data = tibble(
#       x = seq(0, max(stops_disparity_object_chart$rel_search_rate), by = 1)
#     ),
#     colour = "white",
#     size = 0.5,
#     alpha = 0.75
#   ) +
#   geom_vline(
#     aes(xintercept = x),
#     data = tibble(
#       x = seq(0, max(stops_disparity_object_chart$rel_search_rate), by = 5)
#     ),
#     colour = "white"
#   ) +
#   geom_text(colour = chart_elements$label_text_colour, 
#             size = chart_elements$label_text_size, hjust = 0) +
#   scale_x_continuous(expand = expansion(mult = c(0, 0.1)), 
#                      labels = number_format(accuracy = 1, prefix = "x")) +
#   scale_fill_manual(values = search_type_colours) +
#   labs(
#     x = "search rate for this group, relative to search rate for all people"
#   ) +
#   facet_grid(rows = vars(object), scales = "free_y", switch = "y",
#              labeller = label_wrap_gen(width = 14)) +
#   theme_ashby() +
#   theme(
#     axis.text.y = element_markdown(),
#     axis.ticks.y = element_blank(),
#     axis.title.y = element_blank(),
#     legend.position = "none",
#     panel.grid = element_blank(),
#     strip.placement = "outside",
#     strip.text.x = element_text(angle = 0, hjust = 0)
#   )

stops_disparity_object_chart %>% 
  mutate(
    age_range = fct_relevel(age_range, "over 34", "25-34", "18-24", "10-17"),
    rate_label = number(rel_search_rate, accuracy = 0.1, prefix = "x"),
    rel_search_rate = ifelse(rel_search_rate == 0, 0.01, rel_search_rate),
    sex = recode(sex, female = "women and girls", male = "men and boys")
  ) %>% 
  ggplot(aes(object, age_range, fill = rel_search_rate, label = rate_label)) +
  geom_raster(na.rm = TRUE) +
  geom_text(size = chart_elements$label_text_size) +
  scale_x_discrete(labels = function (x) str_wrap(x, 16)) +
  scale_fill_gradient2(trans = "log", low = ucl_colours_list["Bright Blue"], 
                       high = ucl_colours_list["Bright Red"], 
                       midpoint = log(1), na.value = NA) +
  facet_grid(cols = vars(sex), rows = vars(ethnic_group), scales = "free_y", 
             switch = "y") +
  labs(
    title = str_glue("Search rates for demographic groups, relative to the ",
                     "rate for all people, ",
                     "{format(max(stops$year_month), '%B %Y')}"),
    x = NULL, 
    y = NULL
  ) +
  theme_ashby() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none",
    panel.grid = element_blank(),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot",
    strip.placement = "outside",
    strip.text = element_text(hjust = 0.5, vjust = 0.5)
  )
```



# How often to police find items during searches?

The purpose of stop and search is to "enable officers to allay or confirm suspicions about individuals without exercising their power of arrest" ([PACE Code A, paragraph 1.4](https://www.gov.uk/guidance/police-and-criminal-evidence-act-1984-pace-codes-of-practice)). As such, a search that does not find what is being searched for can be considered successful if it prevents an innocent person being arrested and a police officer being taken off the street unnecessarily. Nevertheless, all searches are an "intrusion on the liberty of the person" (PACE Code A, paragraph 1.2) and high proportions of searches that do not find anything may indicate that searches are not well targeted.

The data released by the Home Office do not specify whether or not the item police were looking for was found during a search. Instead, we can measure whether a search resulted in some formal criminal-justice process. This is not a perfect measure of whether an item was found during a search, because a person might be arrested for some other reason (for example because there was an outstanding warrant for their arrest) or contraband might be found but police deal with it informally. Nevertheless, this is the least-worst measure of search outcomes that is currently available.

```{r positive results chart, fig.asp=0.5}
search_result_counts <- stops %>% 
  mutate(
    object = case_when(
      object == "weapons" & 
        legislation == "Police and Criminal Evidence Act 1984 (section 1)" ~ 
        "weapons (based on reasonable suspicion)",
      object == "weapons" & 
        legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
        "weapons (based on authorisation)",
      object == "weapons" ~ "unknown",
      TRUE ~ object
    ),
    positive = !outcome %in% c("no further action", "unknown"),
    year_month = as_date(year_month)
  ) %>% 
  filter(!object %in% c("other", "unknown"), outcome != "unknown") %>% 
  count(year_month, object, positive) %>% 
  group_by(year_month, object) %>% 
  mutate(prop = n / sum(n)) %>% 
  ungroup()

search_result_month_counts <- stops %>% 
  mutate(
    positive = !outcome %in% c("no further action", "unknown"),
    year_month = as_date(year_month)
  ) %>% 
  count(year_month, positive) %>% 
  group_by(year_month) %>% 
  mutate(prop = n / sum(n)) %>% 
  ungroup()

search_result_order <- search_result_counts %>% 
  filter(positive, year_month > max(year_month) - months(24)) %>% 
  group_by(object) %>% 
  summarise(prop = mean(prop), .groups = "drop") %>% 
  arrange(desc(prop))

search_result_trends <- search_result_counts %>% 
  filter(positive, year_month >= max(year_month) - months(24)) %>% 
  group_by(object) %>% 
  arrange(year_month) %>% 
  mutate(
    change = prop / first(prop),
    year_month = as_date(year_month)
  ) %>% 
  ungroup() %>% 
  as_tsibble(key = object, index = year_month) %>% 
  model(lm = fable::TSLM(change ~ trend())) %>% 
  mutate(coefs = map(lm, broom::tidy)) %>% 
  unnest(cols = c(coefs)) %>% 
  filter(term == "trend()", p.value < 0.05)

search_result_month_trends <- search_result_month_counts %>%
  filter(positive, year_month >= max(year_month) - months(24)) %>%
  arrange(year_month) %>%
  mutate(change = prop / first(prop)) %>% 
  as_tsibble(index = year_month) %>% 
  model(lm = fable::TSLM(change ~ trend())) %>% 
  mutate(coefs = map(lm, broom::tidy)) %>% 
  unnest(cols = c(coefs)) %>% 
  filter(term == "trend()", p.value < 0.05)

search_result_counts %>% 
  filter(positive) %>%
  mutate(object = fct_relevel(object, pull(search_result_order, object))) %>% 
  ggplot(aes(year_month, prop, colour = object)) +
  geom_segment(aes(xend = year_month, yend = 0), size = 0.25, 
               colour = "grey70") +
  geom_point(size = 0.75) +
  geom_smooth(method = "loess", formula = "y ~ x", se = FALSE) +
  scale_x_date(date_breaks = "1 year", date_labels = "'%y",
               expand = expansion(mult = c(0.025, 0.025))) +
  scale_y_continuous(labels = percent_format(accuracy = 1),
                     expand = expansion(mult = c(0, 0.025))) +
  scale_colour_manual(values = search_type_colours) +
  facet_grid(
    cols = vars(object),
    labeller = as_labeller(function (string) {
      str_wrap(paste("searches for", string), 20)
    })
  ) +
  labs(
    title = str_glue(
      "Change in proportion of searches with a formal outcome, ",
      "{format(min(stops$date), '%B %Y')} to {format(max(stops$date), '%B %Y')}"
    ),
    x = NULL, 
    y = "proportion resulting a formal outcome"
  ) +
  theme_ashby() +
  theme(
    legend.position = "none",
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```

Overall, about `r percent(tail(search_result_month_counts$prop, 1))` of searches in `r format(max(stops$date), "%B %Y")` resulted in a formal criminal-justice outcome (arrest, charge by post, caution, fixed penalty, community/local resolution or drugs warning), while the remaining **`r percent(1 - tail(search_result_month_counts$prop, 1))` of searches resulted in no further action.** Over the past two years, searches for `r head(search_result_order$object, 1)` have been most likely to lead to a formal outcome, while `r percent(1 - tail(search_result_order$prop, 1))` of searches for `r ifelse(tail(search_result_order$object, 1) == "weapons (based on authorisation)", "weapons under a section 60 authorisation", tail(search_result_order$object, 1))` resulted in no further action.

In the past two years, the proportion of searches `r case_when(nrow(filter(search_result_trends, estimate > 0)) > 0 & nrow(filter(search_result_trends, estimate < 0)) > 0 ~ paste("for", vector_to_text(pull(filter(search_result_trends, estimate > 0), object)), "resulting in a formal outcome increased while the proportion of searches for", vector_to_text(pull(filter(search_result_trends, estimate < 0), object)), "resulted in a formal outcome decreased"), nrow(filter(search_result_trends, estimate > 0)) > 0 ~ paste0("for ", vector_to_text(pull(filter(search_result_trends, estimate > 0), object)), " resulting in a formal outcome have", ifelse(nrow(filter(search_result_trends, estimate > 0)) > 2, " all ", " "), "increased"), nrow(filter(search_result_trends, estimate < 0)) > 0 ~ paste0("for ", vector_to_text(pull(filter(search_result_trends, estimate < 0), object)), " resulting in a formal outcome have", ifelse(nrow(filter(search_result_trends, estimate < 0)) > 2, " all ", " "), "decreased"), TRUE ~ "leading to a formal outcome has remained largely constant")`. `r ifelse(search_result_month_trends$p.value < 0.05, paste("Overall, **the proportion of stops with a formal outcome has", ifelse(search_result_month_trends$estimate > 0, "risen", "dropped"), "from", percent(mean(pull(filter(search_result_month_counts, positive, year(year_month) == 2018), prop))), "in 2018 to", percent(mean(pull(filter(search_result_month_counts, positive, year_month > max(year_month) - months(6)), prop))), "in the past 6 months**."), "")`


```{r results by type}
results_by_type <- stops %>% 
  mutate(
    object = case_when(
      object == "weapons" & 
        legislation == "Police and Criminal Evidence Act 1984 (section 1)" ~ 
        "weapons (based on reasonable suspicion)",
      object == "weapons" & 
        legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
        "weapons (based on authorisation)",
      object == "weapons" ~ "unknown",
      TRUE ~ object
    ),
    outcome = fct_rev(recode(
      outcome, 
      "community/local resolution" = "community resolution"
    ))
  ) %>% 
  filter(
    !object %in% c("other", "unknown"), 
    !outcome %in% c("no further action", "unknown", "drugs warning", "caution"), 
    year_month == max(year_month)
  ) %>% 
  count(object, outcome) %>% 
  group_by(object) %>% 
  mutate(prop = n / sum(n)) %>% 
  ungroup()

most_common_outcome <- stops %>% 
  filter(!outcome %in% c("no further action", "unknown")) %>% 
  count(outcome, sort = TRUE) %>% 
  head(1) %>% 
  pull(outcome) %>% 
  as.character()
```


When a stop does result in formal action, the most common outcome is `r most_common_outcome` (used in `r percent(head(pull(janitor::adorn_percentages(count(filter(stops, !outcome %in% c("no further action", "unknown")), outcome, sort = TRUE), "col"), n), 1))` of cases with a formal outcome). However, which action police choose varies with the type of search: `r percent(pull(head(arrange(filter(results_by_type, outcome == most_common_outcome), desc(prop)), 1), prop))` of positive searches for `r pull(head(arrange(filter(results_by_type, outcome == most_common_outcome), desc(prop)), 1), object)` result in `r most_common_outcome`, compared to only `r percent(pull(tail(arrange(filter(results_by_type, outcome == most_common_outcome), desc(prop)), 1), prop))` of positive searches for `r pull(tail(arrange(filter(results_by_type, outcome == most_common_outcome), desc(prop)), 1), object)`. The outcomes of some searches suggest that the outcome does not relate to the type of contraband that police were looking for. For example, fixed penalties are not a legally available option for dealing with weapons or firearms offences, but `r percent(pull(filter(results_by_type, outcome == "fixed penalty", object == "weapons (based on reasonable suspicion)"), prop))` of searches for weapons based on reasonable suspicion, `r percent(pull(filter(results_by_type, outcome == "fixed penalty", object == "weapons (based on authorisation)"), prop))` of searches for weapons based on section-60 authorisations and `r percent(pull(filter(results_by_type, outcome == "fixed penalty", object == "firearms"), prop))` of searches for firearms resulted in fixed penalties being issued. This suggests that some weapons and firearms searches result in police not finding weapons but discovering more-minor offences such as cannabis possession.

```{r results by type chart, fig.asp=0.67}
ggplot(
  results_by_type, 
  aes(prop, outcome, fill = outcome, 
      label = str_glue(" {percent(prop, accuracy = 1)}"))
) +
  geom_col() +
  geom_text(
    colour = chart_elements$label_text_colour,
    size = chart_elements$label_text_size,
    hjust = 0
  ) +
  scale_x_continuous(
    limits = c(0, 1),
    expand = expansion(mult = c(0, 0.02)), 
    labels = percent_format()
  ) +
  scale_fill_manual(
    values = unname(ucl_colours_list[c("Bright Green", "Bright Blue", 
                                       "Bright Green", "Light Blue")])
  ) +
  facet_grid(rows = vars(object), labeller = label_wrap_gen(width = 12)) +
  labs(
    title = str_glue("Formal outcomes for different types of search, ",
                     "{format(max(stops$year_month), '%B %Y')}"),
    x = "proportion of all searches resulting in a formal outcome",
    y = NULL
  ) +
  theme_ashby() +
  theme(
    panel.grid.major.x = element_line(),
    panel.grid.major.y = element_blank(),
    legend.position = "none",
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )
```



```{r outcomes by ethnicity}
stops_by_ethnicity <- stops %>% 
  separate(self_defined_ethnicity, c("ethnic_group", "ethnicity"), " - ") %>% 
  mutate(
    ethnic_group = str_extract(ethnic_group, "^\\w+"),
    formal_disposal = outcome != "no further action",
    object = case_when(
      object == "weapons" & 
        legislation == "Police and Criminal Evidence Act 1984 (section 1)" ~ 
        "weapons (based on reasonable suspicion)",
      object == "weapons" & 
        legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
        "weapons (based on authorisation)",
      object == "weapons" ~ "unknown",
      TRUE ~ object
    )
  ) %>% 
  filter(
    !is.na(ethnic_group),
    !object %in% c("other", "unknown"), 
    outcome != "unknown",
    as_date(year_month) > as_date(max(year_month)) - months(5)
  )

outcomes_by_ethnicity <- stops_by_ethnicity %>% 
  count(object, formal_disposal, ethnic_group) %>% 
  mutate_if(is.factor, as.character) %>% 
  pivot_wider(names_from = formal_disposal, values_from = n) %>% 
  replace_na(list(`TRUE` = 0, `FALSE` = 0)) %>% 
  mutate(prop = `TRUE` / (`FALSE` + `TRUE`))

outcomes_by_ethnicity_order <- outcomes_by_ethnicity %>% 
  filter(object == "drugs") %>% 
  arrange(prop) %>% 
  pull(ethnic_group)

outcomes_by_ethnicity_model <- stops_by_ethnicity %>% 
  mutate(ethnic_group = fct_relevel(ethnic_group, "White")) %>% 
  nest(data = -object) %>% 
  mutate(model = map(data, function (x) {
    broom::tidy(glm(formal_disposal ~ ethnic_group, data = x))
  })) %>% 
  select(object, model) %>% 
  unnest(cols = model) %>% 
  filter(term %in% c("ethnic_groupAsian", "ethnic_groupBlack")) %>% 
  mutate(
    odds_ratio = exp(estimate),
    sig = p.value < 0.05 & !between(odds_ratio, 0.95, 1.05),
    search_type = str_glue("searches of {str_remove(term, '^ethnic_group')} ",
                           "people for {object}"),
    diff_type = ifelse(odds_ratio > 1, str_glue("higher for {search_type}"), 
                       str_glue("lower for {search_type}"))
  )
```

`r ifelse(sum(outcomes_by_ethnicity_model$sig) / length(outcomes_by_ethnicity_model$sig) > 0.5, str_glue("Just as some ethnic groups are more likely to be stopped than others, the probability of a stop resulting in a formal criminal-justice outcome also varies by ethnicity: over the past six months, the probability of a formal outcome to a search is {vector_to_text(pull(arrange(filter(outcomes_by_ethnicity_model, sig), desc(odds_ratio)), diff_type))}."), paste0("While the rate of searches varies between ethnic groups, the probability of a search resulting in a formal criminal-justice outcome is broadly the same across ethnicities – over the past six months, ", ifelse(sum(outcomes_by_ethnicity_model$sig) > 0, str_glue("the probability of a formal outcome to searches of Black or Asian people is only significantly different from the probabilty of a formal outcome to searches of White people for {vector_to_text(pull(filter(outcomes_by_ethnicity_model, sig), search_type))}"), "the probability of a formal outcome to searches of Black or Asian people was not significantly different from the probabilty of a formal outcome to searches of White people for any of the main search types"), "."))`

```{r outcomes by ethnicity chart, fig.asp=0.33}
outcomes_by_ethnicity %>% 
  mutate(
    ethnic_group = fct_relevel(as.character(ethnic_group), 
                               outcomes_by_ethnicity_order),
    prop_label = percent(prop, accuracy = 1, prefix = " ", suffix = "% "),
    align = ifelse(prop > max(prop) / 2, 1, 0)
  ) %>% 
  ggplot(aes(prop, ethnic_group, colour = as.logical(align), fill = object, 
             label = prop_label, hjust = align)) +
  geom_col(colour = NA) +
  geom_text(size = chart_elements$label_text_size) +
  scale_x_continuous(breaks = c(0, 0.1, 0.2), labels = percent_format()) +
  scale_colour_manual(
    values = c(`FALSE` = chart_elements$label_text_colour, `TRUE` = "white")
  ) +
  scale_fill_manual(values = search_type_colours) +
  facet_grid(cols = vars(object), labeller = label_wrap_gen(width = 16)) +
  labs(
    title = str_glue(
      "Proportion of searches resulting in a formal outcome, ", 
      "{ifelse(format(max(stops$year_month), '%Y') == format(as_date(max(stops$year_month)) - months(5), '%Y'), format(as_date(max(stops$year_month)) - months(5), '%B'), format(as_date(max(stops$year_month)) - months(5), '%B %Y'))}",
      " to {format(max(stops$year_month), '%B %Y')}"
    ),
    x = NULL,
    y = NULL
  ) +
  theme_ashby() +
  theme(
    axis.ticks.y = element_blank(),
    legend.position = "none",
    panel.grid.major.x = element_line(),
    panel.grid.major.y = element_blank(),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )

```



# Where do stops happen?

```{r deprivation, include=FALSE}
stops_by_lsoa <- stops %>% 
  filter(!is.na(latitude), !is.na(longitude), year_month == max(year_month)) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_join(lsoa) %>% 
  st_set_geometry(NULL) %>% 
  mutate(object = case_when(
    object == "weapons" & 
      legislation == "Criminal Justice and Public Order Act 1994 (section 60)" ~ 
      "weapons under section 60",
    object == "weapons" ~ "weapons under section 1",
    TRUE ~ object
  ))

stop_concentration <- stops_by_lsoa %>% 
  count(lsoa_code, name = "searches") %>% 
  arrange(desc(searches)) %>% 
  mutate(
    csum_searches = cumsum(searches),
    csum_searches = csum_searches / max(csum_searches),
    perc_rank = row_number() / n()
  ) %>% 
  filter(csum_searches > 0.5) %>% 
  slice(1) %>% 
  pull(perc_rank)

stops_by_deprivation <- stops_by_lsoa %>% 
  count(lsoa_code, name = "searches") %>% 
  left_join(imd, by = "lsoa_code") %>% 
  mutate(imd_perc = ceiling(imd_perc * 100)) %>% 
  arrange(imd_perc) %>% 
  count(imd_perc, wt = searches, name = "searches") %>% 
  mutate(
    csum_searches = cumsum(searches),
    csum_searches = csum_searches / max(csum_searches)
  ) %>% 
  filter(imd_perc == 50) %>% 
  slice(1) %>% 
  pull(csum_searches)

stops_by_deprivation_object <- stops_by_lsoa %>% 
  filter(
    object %in% c("drugs", "firearms", "stolen goods", 
                  "weapons under section 1", "weapons under section 60")
  ) %>% 
  count(object, lsoa_code, name = "searches") %>% 
  left_join(imd, by = "lsoa_code") %>% 
  mutate(imd_perc = ceiling(imd_perc * 100)) %>% 
  arrange(imd_perc) %>% 
  count(object, imd_perc, wt = searches, name = "searches") %>% 
  group_by(object) %>% 
  mutate(
    csum_searches = cumsum(searches),
    csum_searches = csum_searches / max(csum_searches)
  ) %>% 
  filter(imd_perc == 50) %>% 
  slice(1) %>% 
  ungroup() %>% 
  arrange(desc(csum_searches))
```


Stop and search is geographically concentrated in some parts of London: **half of searches in `r format(max(stops$date), "%B %Y")` occurred in `r percent(stop_concentration)` of neighbourhoods**. `r ifelse(stops_by_deprivation < 45, str_glue("Searches are also concentrated in deprived areas: {percent(stops_by_deprivation)} of searches took place in neighbourhoods that were more deprived than average.", ifelse(max(stops_by_deprivation_object$csum_searches) > stops_by_deprivation + 0.03, str_glue(" In particular, {percent(pull(slice(stops_by_deprivation_object, 1), csum_searches))} of searches for {pull(slice(stops_by_deprivation_object, 1), object)} occurred in the most-deprived half of neighbourhoods."), "")), "")`

```{r include=FALSE}
searches_by_borough <- stops %>% 
  filter(!is.na(latitude), !is.na(longitude), year_month == max(year_month)) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_transform(27700) %>% 
  st_join(london_boroughs) %>% 
  as_tibble() %>% 
  count(borough, name = "searches") %>% 
  filter(!is.na(borough)) %>% 
  arrange(desc(searches))

searches_by_ward <- stops %>% 
  filter(!is.na(latitude), !is.na(longitude), year_month == max(year_month)) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_transform(27700) %>% 
  st_join(london_wards) %>% 
  as_tibble() %>% 
  count(borough, ward, name = "searches") %>% 
  filter(!is.na(borough), !is.na(ward)) %>% 
  arrange(desc(searches))
```

```{r include=FALSE}
grid <- london_outline %>% 
  st_transform(27700) %>% 
  st_make_grid(cellsize = 1000, square = FALSE) %>% 
  st_sf() %>% 
  st_intersection(london_outline) %>% 
  mutate(id = row_number())

grid_stops <- stops %>% 
  filter(!is.na(latitude), !is.na(longitude), year_month == max(year_month)) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_transform(27700) %>% 
  st_join(grid) %>% 
  as_tibble() %>% 
  count(id, name = "searches") %>% 
  full_join(grid, by = "id") %>% 
  filter(!is.na(id)) %>% 
  mutate(searches = ifelse(searches == 0 | is.na(searches), NA, searches)) %>%
  st_sf()

hotspot_labels <- grid_stops %>% 
  arrange(desc(searches)) %>% 
  slice(1:20) %>% 
  st_centroid() %>% 
  mutate(
    coord_x = st_coordinates(.)[, 1], 
    coord_y = st_coordinates(.)[, 2],
    nearest_station_id = st_nearest_feature(., london_stations)
  ) %>% 
  left_join(
    st_set_geometry(london_stations, NULL), 
    by = c("nearest_station_id" = "id")
  ) %>% 
  as_tibble() %>% 
  distinct(name, .keep_all = TRUE) %>% 
  head(12) %>%
  mutate(label = str_glue("{ordinal(row_number())}. {name}"))
```

Of the 33 boroughs in London, the most searches in `r format(max(stops$date), "%B")` took place in `r pull(slice(searches_by_borough, 1), borough)` (`r comma(pull(slice(searches_by_borough, 1), searches))` searches), `r pull(slice(searches_by_borough, 2), borough)` (`r comma(pull(slice(searches_by_borough, 2), searches))`) and `r pull(slice(searches_by_borough, 3), borough)` (`r comma(pull(slice(searches_by_borough, 3), searches))`), while the fewest took place in `r pull(slice(searches_by_borough, 33), borough)` (`r comma(pull(slice(searches_by_borough, 33), searches))` searches), `r pull(slice(searches_by_borough, 32), borough)` (`r comma(pull(slice(searches_by_borough, 32), searches))`) and `r pull(slice(searches_by_borough, 31), borough)` (`r comma(pull(slice(searches_by_borough, 31), searches))`). By dividing London into `r comma(nrow(grid))` equally-sized cells, we can identify the places in which most stops occur:

```{r, fig.asp=1}
grid_stops %>% 
  ggplot(aes(colour = searches, fill = searches)) +
  geom_sf() +
  geom_sf(data = london_boroughs, colour = "grey80", fill = NA, size = 0.2) +
  geom_sf_text(
    aes(label = str_wrap(str_replace(borough, " and ", " & "), 10)),
    data = london_boroughs,
    colour = chart_elements$label_text_colour,
    size = chart_elements$label_text_size * 0.8,
    lineheight = chart_elements$label_text_lineheight,
    inherit.aes = FALSE,
    check_overlap = TRUE
  ) +
  # West London labels to the left
  ggrepel::geom_label_repel(
    aes(x = coord_x, y = coord_y, label = str_wrap(label, 15)),
    data = filter(hotspot_labels, coord_x < median(coord_x)),
    colour = chart_elements$label_text_colour,
    fill = "white",
    size = chart_elements$label_text_size,
    lineheight = chart_elements$label_text_lineheight,
    hjust = 1,
    box.padding = unit(2, "lines"),
    label.padding = unit(0.2, "lines"),
    label.size = NA,
    xlim = c(NA, min(hotspot_labels$coord_x)),
    max.iter = 10000
  ) +
  # East London labels to the right
  ggrepel::geom_label_repel(
    aes(x = coord_x, y = coord_y, label = str_wrap(label, 15)),
    data = filter(hotspot_labels, coord_x >= median(coord_x)),
    colour = chart_elements$label_text_colour,
    fill = "white",
    size = chart_elements$label_text_size,
    lineheight = chart_elements$label_text_lineheight,
    hjust = 0,
    box.padding = unit(2, "lines"),
    label.padding = unit(0.2, "lines"),
    label.size = NA,
    xlim = c(max(hotspot_labels$coord_x), NA),
    max.iter = 10000
  ) +
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  scale_colour_distiller(aesthetics = c("colour", "fill"), palette = "Oranges", 
                         direction = 1, na.value = "grey90") +
  labs(
    title = str_glue("Location of searches, {format(max(stops$date), '%B %Y')}"),
    colour = str_glue("number of\nsearches"),
    fill = str_glue("number of\nsearches")
  ) +
  theme_ashby() +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.justification = c(0, 0),
    legend.position = c(0, 0),
    panel.grid = element_blank(),
    plot.margin = margin(t = 18, b = 18),
    plot.title = element_markdown(face = "plain", size = 12, 
                                  margin = margin(b = 9)),
    plot.title.position = "plot"
  )

```

Of the `r comma(nrow(london_wards))` local-authority wards in London, the ward with the most searches in `r format(max(stops$date), "%B %Y")` was `r searches_by_ward$ward[1]` ward in `r searches_by_ward$borough[1]`, in which there were more searches than in the `r ifelse(nrow(filter(searches_by_borough, searches < searches_by_ward$searches[1])), str_glue("entire boroughs of {vector_to_text(pull(filter(searches_by_borough, searches < searches_by_ward$searches[1]), borough))}"), str_glue("{comma(nrow(filter(mutate(arrange(searches_by_ward, searches), csum_searches = cumsum(searches)), csum_searches < searches_by_ward$searches[1])))} wards with the fewest searches combined"))`.

```{r}
searches_by_ward %>% 
  mutate(
    searches = comma(searches, accuracy = 1),
    ward = str_glue("{ward}, {borough}")
  ) %>% 
  select(`council ward` = ward, searches) %>% 
  head(10) %>% 
  knitr::kable(align = "lr")
```


```{r section 60 by borough}
s60_by_borough <- stops %>% 
  filter(
    !is.na(latitude), 
    !is.na(longitude), 
    year_month == max(year_month), 
    legislation == "Criminal Justice and Public Order Act 1994 (section 60)"
  ) %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% 
  st_transform(27700) %>% 
  st_join(london_boroughs) %>% 
  as_tibble() %>% 
  count(borough, name = "searches") %>% 
  filter(!is.na(borough)) %>% 
  arrange(desc(searches)) %>% 
  mutate(
    perc = searches / sum(searches),
    csum_perc = cumsum(perc),
    less_than_half = row_number() == 1 | lag(csum_perc) < 0.5,
    label = str_glue("{percent(perc, accuracy = 1)} in {borough}")
  )
```

Searches for weapons under section 60 can only take place in areas in which an inspector (the third-most junior rank of the 11 ranks in the Metropolitan Police) believes "incidents involving serious violence may take place". Of the `r comma(nrow(filter(stops, year_month == max(year_month), legislation == "Criminal Justice and Public Order Act 1994 (section 60)")))` no-suspicion searches under section 60 in `r format(max(stops$date), "%B %Y")`, more than half (`r percent(tail(pull(filter(s60_by_borough, less_than_half), csum_perc), 1))`) took place in `r number_to_text(nrow(filter(s60_by_borough, less_than_half)))` boroughs`r ifelse(nrow(filter(s60_by_borough, less_than_half)) <= 5, str_glue(" ({vector_to_text(pull(filter(s60_by_borough, less_than_half), label))})"), "")`. `r case_when(length(setdiff(london_boroughs$borough, s60_by_borough$borough)) > 10 ~ str_glue("Meanwhile, there were no section-60 searches in {number_to_text(length(setdiff(london_boroughs$borough, s60_by_borough$borough)))} other boroughs."), length(setdiff(london_boroughs$borough, s60_by_borough$borough)) > 0 ~ str_glue("Meanwhile, there were no section-60 searches in {vector_to_text(setdiff(london_boroughs$borough, s60_by_borough$borough), final_sep = ' or ')} boroughs."), TRUE ~ "")`


# A note on data

This analysis is based on data published by the Home Office at [data.police.uk](https://data.police.uk/). The data represent all stop-and-searches recorded by police forces. Officers are legally required to record stop and searches, but some officers may not report some searches for a variety of reasons, ranging from forgetting to do so after a long shift to avoiding doing so because the search was not justified. Searches were included in this report if they were conducted by the Metropolitan Police Service or City of London Police, or by British Transport Police at a location in London. The data are published under the [Open Government Licence version 3.0](https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/).

Search rates are calculated based on [2020 estimates of the population of London by age and ethnic group](https://data.london.gov.uk/dataset/ethnic-group-population-projections) produced by the Mayor of London. Rates based on residential populations are imperfect because some people being searched in London will live outside London, but the vast majority of people searched in London are likely to also live in the region.

This report is published under a [Creative Commons Attribution Licence version 4.0](https://creativecommons.org/licenses/by/4.0/), meaning you are free to copy or redistribute this material in any medium or format, and to remix, transform, and build upon this material for any purpose, even commercially, as long as you comply with the licence terms.

